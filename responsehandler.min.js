(function(d){var f,j,g,k,l,m;g=function(a){var b={};a.find("th").each(function(){var a=d(this).attr("data-col");b[a]={type:d(this).attr("data-type")||"string"};if(p=d(this).attr("data-pattern"))b[a].pattern=p;if(re=d(this).attr("data-re"))b[a].re=RegExp(re)});return b};k=function(a,b){var c=this,e="";d.each(b,function(){e+=f.call(c,a,this)});return e};f=function(a,b){var c='<tr data-id="'+b.id+'">',e;for(e in a)var d=j[a[e].type].call(a[e],b,e),c=c+("<td>"+d+"</td>");return c+"</tr>"};j={date:function(a,
b){return(new Date(a[b])).format(this.pattern||"m/dd/yyyy")},currency:function(a,b){var c=parseFloat(a[b]),c=Math.round(c*Math.pow(10,2))/Math.pow(10,2);return"$"+c},string:function(a,b){return a[b]},url:function(a,b){for(var c=this.pattern,d=c.match(this.re,""),h=0;h<d.length;h++)var n=d[h].replace("$",""),c=c.replace(d[h],a[n]);return'<a href="'+c+'">'+a[b]+"</a>"},empty:function(){return"&nbsp;"}};GridResponseHandler={success:function(a){var b=d("table.add"),c=b.find("thead"),b=b.find("tbody"),
c=g.call(this,c),a=f.call(this,c,a);b.append(a);b.slideDown()}};l={success:function(a){alert(a)},error:function(a){alert(a)}};m={success:function(a){this.toaster.success(a)},error:function(a){this.toaster.error(a)}};d.responseHandler={current:null,error:function(a){this.current.error(a)},success:function(a){this.current.success(a)}};d.fn.responseHandlerFactory=function(a){var a=a||{},b=d("#toaster").toaster(),c=a.handlers||{};baseHandler=l;b.exists&&(baseHandler=m,this.toaster=b);for(var e in c)c[e]=
d.extend(!1,baseHandler,c[e]);c.message=baseHandler;me=this;me.success=function(a){for(var b in a)c[b]&&c[b].success.call(this,a[b])};me.error=function(a){for(var b in a)c[b]&&c[b].error.call(this,a[b])};return me};d.responseHandler.map={url:{success:function(a){document.location.href=a}},search:{success:function(a){var b=d("table.search"),c=b.find("thead"),b=b.find("tbody"),c=g.call(this,c),a=k.call(this,c,a);b.html(a);b.slideDown()}},destroy:{success:function(a){var b=d('[data-id="'+a+'"]');b.slideUp("slow",
function(){b.remove()})}},validation:{error:function(a){var b={},c=function(a,e){for(var f in a){var i=a[f],g=e?e+"_"+f:f;d.isArray(i)?b[g]=i:"object"===typeof i&&c(i,g)}};c(a);for(var e in b)a=d("#"+e),a.addClass("error"),a.attr("title",b[e][0]),a.change(function(){d(this).removeClass("error").unbind();d(this).removeAttr("title")})}},warning:{success:function(a){this.toaster.warn(a)}},grid:GridResponseHandler}})(jQuery);
